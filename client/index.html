<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Distributed Quiz</title>
    <script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
    <link rel="import" href="components/d-question.html">
    <link rel="import" href="components/d-homepage.html">

    <style>
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            font-family: 'Roboto', 'Noto', 'Helvetica Neue', 'Arial', sans-serif;
        }
    </style>
</head>
<body>
    <d-homepage games='[{
        "name": "Demo Quiz"
    }, {
        "name": "General Knowledge"
    }]'>

    </d-homepage>
    <!--<d-question-->
            <!--question="What is the capital of Spain?"-->
            <!--choices='["Paris", "London", "Madrid"]'-->
    <!--&gt;-->
    </d-question>
    <script src="bower_components/socket.io-client/dist/socket.io.js"></script>
    <script src="bower_components/localforage/dist/localforage.js"></script>
    <script>
        let socket = io.connect('localhost:8080');

        let timeCorrection = 0;

        socket.on('request time', function() {
            let timestamp = Date.now() + Math.round(timeCorrection);
            socket.emit('respond time', {
                timestamp: timestamp
            });
        });

        socket.on('correct time', function(data) {
            timeCorrection = timeCorrection + data.correction;
        });


        localforage.getItem('userId', function(err, id) {
            if (err) {
                console.error(err);
            } else if (id === 0 || id) {
                console.log('User exists with id ', id);
            } else {
                socket.emit('create new user');
            }
        });

        socket.on('new user', function(data) {
            console.log('Created New User with id ', data.id);
            localforage.setItem('userId', data.id);

        });
//        }
    </script>
</body>
</html>